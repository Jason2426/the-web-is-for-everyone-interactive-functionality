Copied Code 






 /* link delen en hoeveel keer gedeeld */ 

app.get('/', (request, response) => {
    fetchJson(redpers_url).then((data) => {
      fetchJson(directus_url).then((shares) => {
        // Map de data array uit wordpress, map is een soort 'loop' structuur voor arrays
        data.map((post) =>
          // Gebruik de Object.assign() functie om het aantal shares toe te voegen op het article
          // NB: Object.assign past het 'article' object
          Object.assign(post, {
            // Zoek in shares naar article.slug, koppel het aantal shares of 0 als het niet bestaat
            shares: shares.data.find(({ slug }) => slug == post.slug)?.shares || 0,
          })
        )
        response.render('index', { posts: data })
      })
    })
  })
  
  // Failsafe voor als iemand /article intypt zonder slug...
  app.get('/post', (request, response) => {
    response.redirect(301, '/')
  })
  
  app.post('/post/:slug', (request, response) => {
    fetchJson(`${directus_url}?filter[slug][_eq]=${request.params.slug}`).then(({ data }) => {
      // Doe een PATCH op directus, stuur de id mee als die er is.
      fetchJson(`${directus_url}/${data[0]?.id ? data[0].id : ''}`, {
        method: data[0]?.id ? 'PATCH' : 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          slug: request.params.slug,
          shares: data.length > 0 ? data[0].shares + 1 : 1,
        }),
      }).then((result) => {
        console.log(result)
      })
    })
    response.redirect(301, `/post/${request.params.slug}`)
  })
  
  app.get('/post/:slug', (request, response) => {
    fetchJson(`${redpers_url}?slug=${request.params.slug}`).then((data) => {
      // fetch de #shares
      response.render('post', { post: data[0] })
    })
  })

  /* end */